version: '3.8'

services:
  # TONL MCP Server - Main HTTP/SSE Server
  tonl-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: tonl-mcp-server
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - TONL_AUTH_TOKEN=${TONL_AUTH_TOKEN:-}
    networks:
      - tonl-network
    # Uncomment for logging configuration
    # logging:
    #   driver: "json-file"
    #   options:
    #     max-size: "10m"
    #     max-file: "3"

  # Qdrant Vector Database (Optional)
  # Uncomment to enable Qdrant support
  # qdrant:
  #   image: qdrant/qdrant:latest
  #   container_name: tonl-qdrant
  #   restart: unless-stopped
  #   ports:
  #     - "6333:6333"  # REST API
  #     - "6334:6334"  # gRPC
  #   volumes:
  #     - qdrant-data:/qdrant/storage
  #   networks:
  #     - tonl-network
  #   environment:
  #     - QDRANT__SERVICE__GRPC_PORT=6334

  # Milvus Vector Database (Optional)
  # Uncomment to enable Milvus support
  # milvus:
  #   image: milvusdb/milvus:latest
  #   container_name: tonl-milvus
  #   restart: unless-stopped
  #   ports:
  #     - "19530:19530"  # gRPC
  #     - "9091:9091"    # Metrics
  #   volumes:
  #     - milvus-data:/var/lib/milvus
  #   networks:
  #     - tonl-network
  #   environment:
  #     - ETCD_USE_EMBED=true
  #     - COMMON_STORAGETYPE=local

networks:
  tonl-network:
    driver: bridge

volumes:
  # qdrant-data:
  # milvus-data: